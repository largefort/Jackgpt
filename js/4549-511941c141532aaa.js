(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4549],{98834:function(e,a,t){"use strict";var s=t(57437),n=t(2265),l=t(20251);a.Z=n.memo(e=>{let{code:a=404,isUnknwonReason:t,unknownReason:n}=e,{t:i}=(0,l.$G)();return(0,s.jsxs)("div",{className:"flex items-center justify-center w-screen h-screen",children:[(0,s.jsx)("h1",{className:"mr-5 h-[50px] leading-[50px] pr-5 text-[24px] font-medium",style:{borderRight:"1px solid rgba(0,0,0,.3)"},children:a}),(0,s.jsx)("div",{className:"text-sm",children:n||i(t?"share.common.appUnkonwError":"share.common.appUnavailable")})]})})},54549:function(e,a,t){"use strict";t.d(a,{Z:function(){return H}});var s=t(57437),n=t(2265),l=t(27857),i=t(56091);let o=(0,i.kr)({currentConversationId:"",appPrevChatList:[],pinnedConversationList:[],conversationList:[],showConfigPanelBeforeChat:!1,newConversationInputs:{},handleNewConversationInputsChange:()=>{},inputsForms:[],handleNewConversation:()=>{},handleStartChat:()=>{},handleChangeConversation:()=>{},handlePinConversation:()=>{},handleUnpinConversation:()=>{},handleDeleteConversation:()=>{},conversationRenaming:!1,handleRenameConversation:()=>{},handleNewConversationCompleted:()=>{},chatShouldReloadKey:"",isMobile:!1,isInstalledApp:!1,handleFeedback:()=>{},currentChatInstanceRef:{current:{handleStop:()=>{}}}}),r=()=>(0,i.qp)(o);var c=t(20251),d=t(30713),u=t(13557),m=t(10947),p=t(51966),x=t(47512),h=t(52181),g=t(67635);let v=e=>{let a=(0,n.useMemo)(()=>!!e,[e]),{data:t,isLoading:s,error:l}=(0,d.ZP)(e?null:"appInfo",p.Cb),i=(0,n.useMemo)(()=>{if(a){let{id:a,app:t}=e;return{app_id:a,site:{title:t.name,icon:t.icon,icon_background:t.icon_background,prompt_public:!1,copyright:""},plan:"basic"}}return t},[a,e,t]),o=(0,n.useMemo)(()=>null==i?void 0:i.app_id,[i]);(0,n.useEffect)(()=>{(null==i?void 0:i.site.default_language)&&(0,g.changeLanguage)(i.site.default_language)},[i]);let[r,v]=(0,u.Z)("conversationIdInfo",{defaultValue:{}}),f=(0,n.useMemo)(()=>(null==r?void 0:r[o||""])||"",[o,r]),b=(0,n.useCallback)(e=>{o&&v({...r,[o||""]:e})},[o,r,v]),[y,j]=(0,n.useState)(!0),[C,N]=(0,n.useState)(""),w=(0,n.useMemo)(()=>f===C?"":f,[f,C]),{data:k}=(0,d.ZP)(["appParams",a,o],()=>(0,p.LX)(a,o)),{data:_}=(0,d.ZP)(["appMeta",a,o],()=>(0,p.WA)(a,o)),{data:Z,mutate:S}=(0,d.ZP)(["appConversationData",a,o,!0],()=>(0,p.ku)(a,o,void 0,!0,100)),{data:I,isLoading:P,mutate:M}=(0,d.ZP)(["appConversationData",a,o,!1],()=>(0,p.ku)(a,o,void 0,!1,100)),{data:D,isLoading:R}=(0,d.ZP)(w?["appChatList",w,a,o]:null,()=>(0,p.sV)(w,a,o)),E=(0,n.useMemo)(()=>{let e=(null==D?void 0:D.data)||[],a=[];return f&&e.length&&e.forEach(e=>{var t,s;a.push({id:"question-".concat(e.id),content:e.query,isAnswer:!1,message_files:(null===(t=e.message_files)||void 0===t?void 0:t.filter(e=>"user"===e.belongs_to))||[]}),a.push({id:e.id,content:e.answer,agent_thoughts:(0,x.Z)(e.agent_thoughts?(0,x.C)(e.agent_thoughts):e.agent_thoughts,e.message_files),feedback:e.feedback,isAnswer:!0,citation:e.retriever_resources,message_files:(null===(s=e.message_files)||void 0===s?void 0:s.filter(e=>"assistant"===e.belongs_to))||[]})}),a},[D,f]),[F,L]=(0,n.useState)(!1),A=(0,n.useMemo)(()=>(null==Z?void 0:Z.data)||[],[Z]),{t:G}=(0,c.$G)(),q=(0,n.useRef)({}),[T,z]=(0,n.useState)({}),$=(0,n.useCallback)(e=>{q.current=e,z(e)},[]),O=(0,n.useMemo)(()=>((null==k?void 0:k.user_input_form)||[]).filter(e=>e.paragraph||e.select||e["text-input"]).map(e=>e.paragraph?{...e.paragraph,type:"paragraph"}:e.select?{...e.select,type:"select"}:{...e["text-input"],type:"text-input"}),[k]);(0,n.useEffect)(()=>{let e={};O.forEach(a=>{e[a.variable]=a.default||""}),$(e)},[$,O]);let{data:U}=(0,d.ZP)(C?[a,o,C]:null,()=>(0,p.PT)(a,o,C)),[V,W]=(0,n.useState)([]);(0,n.useEffect)(()=>{(null==I?void 0:I.data)&&!P&&W(null==I?void 0:I.data)},[I,P]);let B=(0,n.useMemo)(()=>{var e;let a=V.slice();return F&&(null===(e=a[0])||void 0===e?void 0:e.id)!==""&&a.unshift({id:"",name:G("share.chat.newChatDefaultName"),inputs:{},introduction:""}),a},[V,F,G]);(0,n.useEffect)(()=>{U&&W((0,m.ZP)(e=>{let a=e.findIndex(e=>e.id===U.id);a>-1?e[a]=U:e.unshift(U)}))},[U]);let H=(0,n.useMemo)(()=>{let e=B.find(e=>e.id===f);return!e&&A.length&&(e=A.find(e=>e.id===f)),e},[B,f,A]),{notify:Y}=(0,h.useToastContext)(),K=(0,n.useCallback)(e=>{if(O.length)for(let a=0;a<O.length;a+=1){let t=O[a];if(t.required&&!q.current[t.variable]){e||Y({type:"error",message:G("appDebug.errorMessage.valueOfVarRequired",{key:t.variable})});return}}return!0},[O,Y,G]),Q=(0,n.useCallback)(()=>{K()&&(j(!1),L(!0))},[j,L,K]),X=(0,n.useRef)({handleStop:()=>{}}),J=(0,n.useCallback)(e=>{X.current.handleStop(),N(""),b(e),""!==e||K(!0)?j(!1):j(!0)},[b,j,K]),ee=(0,n.useCallback)(()=>{X.current.handleStop(),N(""),F?J(""):f&&(b(""),j(!0),L(!0),$({}))},[J,f,b,j,L,F,$]),ea=(0,n.useCallback)(()=>{M(),S()},[M,S]),et=(0,n.useCallback)(async e=>{await (0,p.tY)(a,o,e),Y({type:"success",message:G("common.api.success")}),ea()},[a,o,Y,G,ea]),es=(0,n.useCallback)(async e=>{await (0,p.b2)(a,o,e),Y({type:"success",message:G("common.api.success")}),ea()},[a,o,Y,G,ea]),[en,el]=(0,n.useState)(!1),ei=(0,n.useCallback)(async(e,t)=>{let{onSuccess:s}=t;if(!en){try{el(!0),await (0,p.tC)(a,o,e),Y({type:"success",message:G("common.api.success")}),s()}finally{el(!1)}e===f&&ee(),ea()}},[a,o,Y,G,ea,ee,f,en]),[eo,er]=(0,n.useState)(!1),ec=(0,n.useCallback)(async(e,t,s)=>{let{onSuccess:n}=s;if(!eo){if(!t.trim()){Y({type:"error",message:G("common.chat.conversationNameCanNotEmpty")});return}er(!0);try{await (0,p.lo)(a,o,e,t),Y({type:"success",message:G("common.actionMsg.modifiedSuccessfully")}),W((0,m.ZP)(a=>{let s=V.findIndex(a=>a.id===e),n=a[s];a[s]={...n,name:t}})),n()}finally{er(!1)}}},[a,o,Y,G,eo,V]),ed=(0,n.useCallback)(e=>{N(e),b(e),L(!1),M()},[M,b]),eu=(0,n.useCallback)(async(e,t)=>{await (0,p.GM)({url:"/messages/".concat(e,"/feedbacks"),body:{rating:t.rating}},a,o),Y({type:"success",message:G("common.api.success")})},[a,o,G,Y]);return{appInfoError:l,appInfoLoading:s,isInstalledApp:a,appId:o,currentConversationId:f,currentConversationItem:H,handleConversationIdInfoChange:b,appData:i,appParams:k||{},appMeta:_,appPinnedConversationData:Z,appConversationData:I,appConversationDataLoading:P,appChatListData:D,appChatListDataLoading:R,appPrevChatList:E,pinnedConversationList:A,conversationList:B,showConfigPanelBeforeChat:y,setShowConfigPanelBeforeChat:j,setShowNewConversationItemInList:L,newConversationInputs:T,handleNewConversationInputsChange:$,inputsForms:O,handleNewConversation:ee,handleStartChat:Q,handleChangeConversation:J,handlePinConversation:et,handleUnpinConversation:es,conversationDeleting:en,handleDeleteConversation:ei,conversationRenaming:eo,handleRenameConversation:ec,handleNewConversationCompleted:ed,newConversationId:C,chatShouldReloadKey:w,handleFeedback:eu,currentChatInstanceRef:X}};var f=t(13241),b=t(72493),y=t(68201),j=(0,n.memo)(e=>{let{isPin:a,item:t,onOperate:l,onChangeConversation:i,currentConversationId:o}=e,r=(0,n.useRef)(null),c=(0,f.Z)(r);return(0,s.jsxs)("div",{ref:r,className:"\n        flex mb-0.5 last-of-type:mb-0 py-1.5 pl-3 pr-1.5 text-sm font-medium text-gray-700 \n        rounded-lg cursor-pointer hover:bg-gray-50 group\n        ".concat(o===t.id&&"text-primary-600 bg-primary-50","\n      "),onClick:()=>i(t.id),children:[(0,s.jsx)(b.ZG,{className:"shrink-0 mt-1 mr-2 w-4 h-4 text-gray-400 ".concat(o===t.id&&"text-primary-600")}),(0,s.jsx)("div",{className:"grow py-0.5 break-all",title:t.name,children:t.name}),""!==t.id&&(0,s.jsx)("div",{className:"shrink-0 h-6",onClick:e=>e.stopPropagation(),children:(0,s.jsx)(y.Z,{isPinned:!!a,isItemHovering:c,togglePin:()=>l(a?"unpin":"pin",t),isShowDelete:!0,isShowRenameConversation:!0,onRenameConversation:()=>l("rename",t),onDelete:()=>l("delete",t)})})]},t.id)}),C=e=>{let{isPin:a,title:t,list:n,onOperate:l,onChangeConversation:i,currentConversationId:o}=e;return(0,s.jsxs)("div",{children:[t&&(0,s.jsx)("div",{className:"mb-0.5 px-3 h-[26px] text-xs font-medium text-gray-500",children:t}),n.map(e=>(0,s.jsx)(j,{isPin:a,item:e,onOperate:l,onChangeConversation:i,currentConversationId:o},e.id))]})},N=t(97125),w=t(34775),k=t(60237),_=t(90520),Z=t(59548),S=n.memo(e=>{let{isShow:a,saveLoading:t,name:l,onClose:i,onSave:o}=e,{t:r}=(0,c.$G)(),[d,u]=(0,n.useState)(l);return(0,s.jsxs)(Z.Z,{title:r("common.chat.renameConversation"),isShow:a,onClose:i,wrapperClassName:"!z-50",children:[(0,s.jsx)("div",{className:"mt-6 font-medium text-sm leading-[21px] text-gray-900",children:r("common.chat.conversationName")}),(0,s.jsx)("input",{className:"mt-2 w-full rounded-lg h-10 box-border px-3 text-sm leading-10 bg-gray-100",value:d,onChange:e=>u(e.target.value),placeholder:r("common.chat.conversationNamePlaceholder")||""}),(0,s.jsxs)("div",{className:"mt-10 flex justify-end",children:[(0,s.jsx)(w.Z,{className:"mr-2 flex-shrink-0",onClick:i,children:r("common.operation.cancel")}),(0,s.jsx)(w.Z,{type:"primary",className:"flex-shrink-0",onClick:()=>o(d),loading:t,children:r("common.operation.save")})]})]})}),I=()=>{let{t:e}=(0,c.$G)(),{appData:a,pinnedConversationList:t,conversationList:l,handleNewConversation:i,currentConversationId:o,handleChangeConversation:d,handlePinConversation:u,handleUnpinConversation:m,conversationRenaming:p,handleRenameConversation:x,handleDeleteConversation:h,isMobile:g}=r(),[v,f]=(0,n.useState)(null),[b,y]=(0,n.useState)(null),j=(0,n.useCallback)((e,a)=>{"pin"===e&&u(a.id),"unpin"===e&&m(a.id),"delete"===e&&f(a),"rename"===e&&y(a)},[u,m]),Z=(0,n.useCallback)(()=>{f(null)},[]),I=(0,n.useCallback)(()=>{v&&h(v.id,{onSuccess:Z})},[v,h,Z]),P=(0,n.useCallback)(()=>{y(null)},[]),M=(0,n.useCallback)(e=>{b&&x(b.id,e,{onSuccess:P})},[b,x,P]);return(0,s.jsxs)("div",{className:"shrink-0 h-full flex flex-col w-[240px] border-r border-r-gray-100",children:[!g&&(0,s.jsxs)("div",{className:"shrink-0 flex p-4",children:[(0,s.jsx)(N.Z,{className:"mr-3",size:"small",icon:null==a?void 0:a.site.icon,background:null==a?void 0:a.site.icon_background}),(0,s.jsx)("div",{className:"py-1 text-base font-semibold text-gray-800",children:null==a?void 0:a.site.title})]}),(0,s.jsx)("div",{className:"shrink-0 p-4",children:(0,s.jsxs)(w.Z,{className:"justify-start px-3 py-0 w-full h-9 text-sm font-medium text-primary-600",onClick:i,children:[(0,s.jsx)(k.cH,{className:"mr-2 w-4 h-4"}),e("share.chat.newChat")]})}),(0,s.jsxs)("div",{className:"grow px-4 py-2 overflow-y-auto",children:[!!t.length&&(0,s.jsx)("div",{className:"mb-4",children:(0,s.jsx)(C,{isPin:!0,title:e("share.chat.pinnedTitle")||"",list:t,onChangeConversation:d,onOperate:j,currentConversationId:o})}),!!l.length&&(0,s.jsx)(C,{title:t.length&&e("share.chat.unpinnedTitle")||"",list:l,onChangeConversation:d,onOperate:j,currentConversationId:o})]}),(0,s.jsxs)("div",{className:"px-4 pb-4 text-xs text-gray-400",children:["\xa9 ",(null==a?void 0:a.site.copyright)||(null==a?void 0:a.site.title)," ",new Date().getFullYear()]}),!!v&&(0,s.jsx)(_.Z,{title:e("share.chat.deleteConversation.title"),content:e("share.chat.deleteConversation.content")||"",isShow:!0,onClose:Z,onCancel:Z,onConfirm:I}),b&&(0,s.jsx)(S,{isShow:!0,onClose:P,saveLoading:p,name:(null==b?void 0:b.name)||"",onSave:M})]})},P=()=>{let{appData:e,handleNewConversation:a}=r(),[t,l]=(0,n.useState)(!1);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"shrink-0 flex items-center px-3 h-[44px] border-b-[0.5px] border-b-gray-200",children:[(0,s.jsx)("div",{className:"shrink-0 flex items-center justify-center w-8 h-8 rounded-lg",onClick:()=>l(!0),children:(0,s.jsx)(k.gU,{className:"w-4 h-4 text-gray-700"})}),(0,s.jsxs)("div",{className:"grow flex justify-center items-center px-3",children:[(0,s.jsx)(N.Z,{className:"mr-2",size:"tiny",icon:null==e?void 0:e.site.icon,background:null==e?void 0:e.site.icon_background}),(0,s.jsx)("div",{className:"py-1 text-base font-semibold text-gray-800 truncate",children:null==e?void 0:e.site.title})]}),(0,s.jsx)("div",{className:"shrink-0 flex items-center justify-center w-8 h-8 rounded-lg",onClick:a,children:(0,s.jsx)(k.cH,{className:"w-4 h-4 text-gray-700"})})]}),t&&(0,s.jsx)("div",{className:"fixed inset-0 z-50",style:{backgroundColor:"rgba(35, 56, 118, 0.2)"},onClick:()=>l(!1),children:(0,s.jsx)("div",{className:"inline-block h-full bg-white",onClick:e=>e.stopPropagation(),children:(0,s.jsx)(I,{})})})]})},M=(0,n.memo)(e=>{let{form:a,value:t,onChange:n}=e,{t:l}=(0,c.$G)(),{type:i,label:o,required:r,max_length:d,variable:u}=a;return"paragraph"===i?(0,s.jsx)("textarea",{value:t,className:"grow h-[104px] rounded-lg bg-gray-100 px-2.5 py-2 outline-none appearance-none resize-none",onChange:e=>n(u,e.target.value),placeholder:"".concat(o).concat(r?"":"(".concat(l("appDebug.variableTable.optional"),")"))}):(0,s.jsx)("input",{className:"grow h-9 rounded-lg bg-gray-100 px-2.5 outline-none appearance-none",value:t||"",maxLength:d,onChange:e=>n(u,e.target.value),placeholder:"".concat(o).concat(r?"":"(".concat(l("appDebug.variableTable.optional"),")"))})}),D=t(84599),R=()=>{let{t:e}=(0,c.$G)(),{inputsForms:a,newConversationInputs:t,handleNewConversationInputsChange:l,isMobile:i}=r(),o=(0,n.useCallback)((e,a)=>{l({...t,[e]:a})},[t,l]),d=a=>{let{label:n,required:l,variable:i,options:r}=a;return"text-input"===a.type||"paragraph"===a.type?(0,s.jsx)(M,{form:a,value:t[i],onChange:o}):(0,s.jsx)(D.Cy,{popupClassName:"w-[200px]",value:t[i],items:r.map(e=>({value:e,name:e})),onSelect:e=>o(i,e.value),placeholder:"".concat(n).concat(l?"":"(".concat(e("appDebug.variableTable.optional"),")"))})};return a.length?(0,s.jsx)("div",{className:"mb-4 py-2",children:a.map(e=>(0,s.jsxs)("div",{className:"flex mb-3 last-of-type:mb-0 text-sm text-gray-900 ".concat(i&&"!flex-wrap"),children:[(0,s.jsx)("div",{className:"shrink-0 mr-2 py-2 w-[128px] ".concat(i&&"!w-full"),children:e.label}),d(e)]},e.variable))}):null},E=t(39032);t(54440);var F=t(56149);let L=()=>(0,s.jsx)(F.Z,{className:"!h-5"});var A=()=>{let{t:e}=(0,c.$G)(),{appData:a,inputsForms:t,handleStartChat:l,showConfigPanelBeforeChat:i,isMobile:o}=r(),[d,u]=(0,n.useState)(!0),m=null==a?void 0:a.custom_config,p=null==a?void 0:a.site;return(0,s.jsxs)("div",{className:"flex flex-col max-h-[80%] w-full max-w-[720px]",children:[(0,s.jsxs)("div",{className:"\n          grow rounded-xl overflow-y-auto\n          ".concat(i&&"border-[0.5px] border-gray-100 shadow-lg","\n          ").concat(!i&&d&&"border border-indigo-100","\n          ").concat(!i&&!d&&"border-[0.5px] border-gray-100 shadow-lg","\n        "),children:[(0,s.jsxs)("div",{className:"\n            flex flex-wrap px-6 py-4 rounded-t-xl bg-indigo-25\n            ".concat(o&&"!px-4 !py-3","\n          "),children:[i&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"flex items-center h-8 text-2xl font-semibold text-gray-800",children:[(0,s.jsx)(N.Z,{icon:null==a?void 0:a.site.icon,background:"transparent",size:"small"}),null==a?void 0:a.site.title]}),(null==a?void 0:a.site.description)&&(0,s.jsx)("div",{className:"mt-2 w-full text-sm text-gray-500",children:null==a?void 0:a.site.description})]}),!i&&d&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(E.q,{className:"mr-1 mt-1 w-4 h-4 text-indigo-600"}),(0,s.jsx)("div",{className:"grow py-[3px] text-[13px] text-indigo-600 leading-[18px] font-medium",children:e("share.chat.configStatusDes")}),(0,s.jsxs)(w.Z,{className:"shrink-0 px-2 py-0 h-6 bg-white text-xs font-medium text-primary-600 rounded-md",onClick:()=>u(!1),children:[(0,s.jsx)(k.U9,{className:"mr-1 w-3 h-3"}),e("common.operation.edit")]})]}),!i&&!d&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(E.q,{className:"mr-1 mt-1 w-4 h-4 text-indigo-600"}),(0,s.jsx)("div",{className:"grow py-[3px] text-[13px] text-indigo-600 leading-[18px] font-medium",children:e("share.chat.privatePromptConfigTitle")})]})]}),!d&&!i&&(0,s.jsxs)("div",{className:"p-6 rounded-b-xl",children:[(0,s.jsx)(R,{}),(0,s.jsxs)("div",{className:"pl-[136px] flex items-center ".concat(o&&"!pl-0"),children:[(0,s.jsx)(w.Z,{type:"primary",className:"mr-2 text-sm font-medium",onClick:()=>{u(!0),l()},children:e("common.operation.save")}),(0,s.jsx)(w.Z,{className:"text-sm font-medium",onClick:()=>u(!0),children:e("common.operation.cancel")})]})]}),i&&(0,s.jsxs)("div",{className:"p-6 rounded-b-xl",children:[(0,s.jsx)(R,{}),(0,s.jsxs)(w.Z,{className:"px-4 py-0 h-9 ".concat(t.length&&!o&&"ml-[136px]"),type:"primary",onClick:l,children:[(0,s.jsx)(b.ZG,{className:"mr-2 w-4 h-4 text-white"}),e("share.chat.startChat")]})]})]}),i&&(p||m)&&(0,s.jsxs)("div",{className:"mt-4 flex flex-wrap justify-between items-center py-2 text-xs text-gray-400",children:[(null==p?void 0:p.privacy_policy)?(0,s.jsxs)("div",{className:"flex items-center ".concat(o&&"w-full justify-end"),children:[e("share.chat.privacyPolicyLeft"),(0,s.jsx)("a",{className:"text-gray-500",href:null==p?void 0:p.privacy_policy,target:"_blank",rel:"noopener noreferrer",children:e("share.chat.privacyPolicyMiddle")}),e("share.chat.privacyPolicyRight")]}):(0,s.jsx)("div",{}),(null==m?void 0:m.remove_webapp_brand)?null:(0,s.jsx)("div",{className:"flex items-center justify-end ".concat(o&&"w-full"),children:(0,s.jsxs)("a",{className:"flex items-center pr-3 space-x-3",href:"https://dify.ai/",target:"_blank",children:[(0,s.jsx)("span",{className:"uppercase",children:e("share.chat.powerBy")}),(null==m?void 0:m.replace_webapp_logo)?(0,s.jsx)("img",{src:null==m?void 0:m.replace_webapp_logo,alt:"logo",className:"block w-auto h-5"}):(0,s.jsx)(L,{})]})})]})]})},G=t(319),q=t(18730),T=(0,n.memo)(e=>{let{title:a,isMobile:t}=e;return(0,s.jsx)("div",{className:"\n      sticky top-0 flex items-center px-8 h-16 bg-white/80 text-base font-medium \n      text-gray-900 border-b-[0.5px] border-b-gray-100 backdrop-blur-md z-10\n      ".concat(t&&"!h-12","\n      "),children:a})}),z=()=>{let{appParams:e,appPrevChatList:a,currentConversationId:t,currentConversationItem:l,inputsForms:i,newConversationInputs:o,handleNewConversationCompleted:c,isMobile:d,isInstalledApp:u,appId:m,appMeta:x,handleFeedback:h,currentChatInstanceRef:g}=r(),v=(0,n.useMemo)(()=>{let a=e||{};return{...a,supportFeedback:!0,opening_statement:t?null==l?void 0:l.introduction:a.opening_statement}},[e,null==l?void 0:l.introduction,t]),{chatList:f,handleSend:b,handleStop:y,isResponding:j,suggestedQuestions:C}=(0,q.R)(v,{inputs:t?null==l?void 0:l.inputs:o,promptVariables:i},a,e=>(0,p.fD)("",e,u,m));(0,n.useEffect)(()=>{g.current&&(g.current.handleStop=y)},[]);let N=(0,n.useCallback)((e,a)=>{var s;let n={query:e,inputs:t?null==l?void 0:l.inputs:o,conversation_id:t};(null==v?void 0:null===(s=v.file_upload)||void 0===s?void 0:s.image.enabled)&&(null==a?void 0:a.length)&&(n.files=a),b((0,p.Gr)("chat-messages",u,m||""),n,{onGetSuggestedQuestions:e=>(0,p.aW)(e,u,m),onConversationComplete:t?void 0:c,isPublicAPI:!u})},[v,t,l,b,o,c,u,m]),w=(0,n.useMemo)(()=>i.length?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(T,{isMobile:d,title:(null==l?void 0:l.name)||""}),!t&&(0,s.jsxs)("div",{className:"mx-auto w-full max-w-[720px] ".concat(d&&"px-4"),children:[(0,s.jsx)("div",{className:"mb-6"}),(0,s.jsx)(A,{}),(0,s.jsx)("div",{className:"my-6 h-[1px]",style:{background:"linear-gradient(90deg, rgba(242, 244, 247, 0.00) 0%, #F2F4F7 49.17%, rgba(242, 244, 247, 0.00) 100%)"}})]})]}):(0,s.jsx)(T,{isMobile:d,title:(null==l?void 0:l.name)||""}),[t,i,l,d]);return(0,s.jsx)(G.Z,{config:v,chatList:f,isResponding:j,chatContainerInnerClassName:"mx-auto pt-6 w-full max-w-[720px] ".concat(d&&"px-4"),chatFooterClassName:"pb-4",chatFooterInnerClassName:"mx-auto w-full max-w-[720px] ".concat(d&&"px-4"),onSend:N,onStopResponding:y,chatNode:w,allToolIcons:(null==x?void 0:x.tool_icons)||{},onFeedback:h,suggestedQuestions:C})},$=t(32783),O=t(41123),U=t(42872),V=t(98834);let W=e=>{let{className:a}=e,{appInfoError:t,appData:l,appInfoLoading:i,appPrevChatList:o,showConfigPanelBeforeChat:c,appChatListDataLoading:d,chatShouldReloadKey:u,isMobile:m}=r(),p=!c||!!o.length,x=null==l?void 0:l.custom_config,h=null==l?void 0:l.site;return((0,n.useEffect)(()=>{h&&(x?document.title="".concat(h.title):document.title="".concat(h.title," - Powered by Dify"))},[h,x]),i)?(0,s.jsx)($.Z,{type:"app"}):t?(0,s.jsx)(V.Z,{}):(0,s.jsxs)("div",{className:"h-full flex bg-white ".concat(a," ").concat(m&&"flex-col"),children:[!m&&(0,s.jsx)(I,{}),m&&(0,s.jsx)(P,{}),(0,s.jsxs)("div",{className:"grow overflow-hidden ".concat(c&&!o.length&&"flex items-center justify-center"),children:[c&&!d&&!o.length&&(0,s.jsx)("div",{className:"flex w-full items-center justify-center h-full ".concat(m&&"px-4"),children:(0,s.jsx)(A,{})}),d&&p&&(0,s.jsx)($.Z,{type:"app"}),p&&!d&&(0,s.jsx)(z,{},u)]})]})},B=e=>{let{installedAppInfo:a,className:t}=e,n=(0,O.Z)()===O.D.mobile,{appInfoError:l,appInfoLoading:i,appData:r,appParams:c,appMeta:d,appChatListDataLoading:u,currentConversationId:m,currentConversationItem:p,appPrevChatList:x,pinnedConversationList:h,conversationList:g,showConfigPanelBeforeChat:f,newConversationInputs:b,handleNewConversationInputsChange:y,inputsForms:j,handleNewConversation:C,handleStartChat:N,handleChangeConversation:w,handlePinConversation:k,handleUnpinConversation:_,handleDeleteConversation:Z,conversationRenaming:S,handleRenameConversation:I,handleNewConversationCompleted:P,chatShouldReloadKey:M,isInstalledApp:D,appId:R,handleFeedback:E,currentChatInstanceRef:F}=v(a);return(0,s.jsx)(o.Provider,{value:{appInfoError:l,appInfoLoading:i,appData:r,appParams:c,appMeta:d,appChatListDataLoading:u,currentConversationId:m,currentConversationItem:p,appPrevChatList:x,pinnedConversationList:h,conversationList:g,showConfigPanelBeforeChat:f,newConversationInputs:b,handleNewConversationInputsChange:y,inputsForms:j,handleNewConversation:C,handleStartChat:N,handleChangeConversation:w,handlePinConversation:k,handleUnpinConversation:_,handleDeleteConversation:Z,conversationRenaming:S,handleRenameConversation:I,handleNewConversationCompleted:P,chatShouldReloadKey:M,isMobile:n,isInstalledApp:D,appId:R,handleFeedback:E,currentChatInstanceRef:F},children:(0,s.jsx)(W,{className:t})})};var H=e=>{let{installedAppInfo:a,className:t}=e,[i,o]=(0,n.useState)(!1),[r,c]=(0,n.useState)(!1),[d,u]=(0,n.useState)(!1);return((0,l.Z)(async()=>{if(!i){if(!a)try{await (0,U.h)()}catch(e){404===e.status||u(!0),c(!0)}o(!0)}},[]),r)?(0,s.jsx)(V.Z,{isUnknwonReason:d}):i?(0,s.jsx)(B,{installedAppInfo:a,className:t}):null}},68201:function(e,a,t){"use strict";var s=t(57437),n=t(2265),l=t(54440),i=t.n(l),o=t(20251),r=t(44521),c=t(60237),d=t(98398),u=t.n(d),m=t(46286);a.Z=n.memo(e=>{let{className:a,isItemHovering:t,isPinned:l,togglePin:d,isShowRenameConversation:p,onRenameConversation:x,isShowDelete:h,onDelete:g}=e,{t:v}=(0,o.$G)(),[f,b]=(0,n.useState)(!1),y=(0,n.useRef)(null),[j,{setTrue:C,setFalse:N}]=(0,r.Z)(!1);return(0,n.useEffect)(()=>{t||j||b(!1)},[t,j]),(0,s.jsxs)(m.KR,{open:f,onOpenChange:b,placement:"bottom-end",offset:4,children:[(0,s.jsx)(m.xE,{onClick:()=>b(e=>!e),children:(0,s.jsx)("div",{className:i()(a,u().btn,"h-6 w-6 rounded-md border-none py-1",(t||f)&&"".concat(u().open," !bg-gray-100 !shadow-none"))})}),(0,s.jsx)(m.BD,{className:"z-50",children:(0,s.jsxs)("div",{ref:y,className:"min-w-[120px] p-1 bg-white rounded-lg border border--gray-200 shadow-lg",onMouseEnter:C,onMouseLeave:N,onClick:e=>{e.stopPropagation()},children:[(0,s.jsxs)("div",{className:i()(u().actionItem,"hover:bg-gray-50 group"),onClick:d,children:[(0,s.jsx)(c.YP,{className:"shrink-0 w-4 h-4 text-gray-500"}),(0,s.jsx)("span",{className:u().actionName,children:v(l?"explore.sidebar.action.unpin":"explore.sidebar.action.pin")})]}),p&&(0,s.jsxs)("div",{className:i()(u().actionItem,"hover:bg-gray-50 group"),onClick:x,children:[(0,s.jsx)(c.MP,{className:"shrink-0 w-4 h-4 text-gray-500"}),(0,s.jsx)("span",{className:u().actionName,children:v("explore.sidebar.action.rename")})]}),h&&(0,s.jsxs)("div",{className:i()(u().actionItem,u().deleteActionItem,"hover:bg-gray-50 group"),onClick:g,children:[(0,s.jsx)(c.q5,{className:i()(u().deleteActionItemChild,"shrink-0 w-4 h-4 stroke-current text-gray-500 stroke-2")}),(0,s.jsx)("span",{className:i()(u().actionName,u().deleteActionItemChild),children:v("explore.sidebar.action.delete")})]})]})})]})})},47512:function(e,a,t){"use strict";t.d(a,{C:function(){return s},Z:function(){return n}});let s=e=>{if(!e||e.some(e=>void 0===e.position))return e;let a=[...e];return a.sort((e,a)=>e.position-a.position),a},n=(e,a)=>e&&a?e.map(e=>{var t;return e.files&&(null===(t=e.files)||void 0===t?void 0:t.length)>0?{...e,message_files:e.files.map(e=>a.find(a=>a.id===e))}:e}):e},98398:function(e){e.exports={actionItem:"style_actionItem__WNqZw",actionName:"style_actionName__IZ47d",commonIcon:"style_commonIcon__Ztwt5",actionIcon:"style_actionIcon__OOlis",btn:"style_btn__bbesM",open:"style_open__fWjkx",deleteActionItem:"style_deleteActionItem__DlUge",deleteActionItemChild:"style_deleteActionItemChild__EvCDw"}}}]);